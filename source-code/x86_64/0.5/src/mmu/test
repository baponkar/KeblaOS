/*
    Virtual Address  : 0x100000 (1 MB)
    Physical Address : 0x100000 (1 MB)
*/

page_t *get_page(u32int address, int make, page_directory_t *dir)
{
   // Turn the address into an index.
   address /= 0x1000;   // 0x100 (256)
   // Find the page table containing this address.
   u32int table_idx = address / 1024;   // 0x0 (0)
   if (dir->tables[table_idx]) // If this table is already assigned
   {
       return &dir->tables[table_idx]->pages[address%1024]; // 0x100
   }
   else if(make)
   {
       u32int tmp;
       dir->tables[table_idx] = (page_table_t*) kmalloc_ap(sizeof(page_table_t), &tmp);
       memset(dir->tables[table_idx], 0, 0x1000);
       dir->tablesPhysical[table_idx] = tmp | 0x7; // PRESENT, RW, US.
       return &dir->tables[table_idx]->pages[address%1024];
   }
   else
   {
       return 0;
   }
}